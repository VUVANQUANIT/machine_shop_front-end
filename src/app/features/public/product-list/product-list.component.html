<section class="product-list-page">
  <div class="about-box">
    <h2 class="about-box__title">Chúng tôi là ai</h2>
    <p class="about-box__content">
      <strong>HẰNG HẢI – MÁY MÓC CƠ KHÍ & THIẾT BỊ GỖ (ĐÃ QUA SỬ DỤNG)</strong><br />
      Chuyên mua bán máy cũ: máy cưa, máy bào, máy phay, máy nén khí phục vụ ngành mộc và cơ khí.<br />
      Nhận bảo dưỡng – sửa chữa – lắp đặt tận nơi.<br />
      Cam kết máy hoạt động ổn định, giá hợp lý, hỗ trợ kỹ thuật lâu dài.
    </p>
  </div>

  <div class="search-bar">
    <div class="search-bar__input-wrap">
      <input
        type="text"
        [(ngModel)]="searchKeywordValue"
        (keyup.enter)="onSearch()"
        placeholder="Tìm kiếm sản phẩm..."
        class="search-bar__input"
      />
      <button type="button" class="search-bar__btn" (click)="onSearch()">Tìm kiếm</button>
    </div>
    <div class="search-bar__sort">
      <label for="sort">Sắp xếp:</label>
      <select id="sort" [(ngModel)]="sortByValue" (change)="onSortChange()" class="search-bar__select">
        <option value="price,asc">Giá: Thấp → Cao</option>
        <option value="price,desc">Giá: Cao → Thấp</option>
        <option value="createdAt,desc">Mới nhất</option>
        <option value="createdAt,asc">Cũ nhất</option>
        <option value="name,asc">Tên: A → Z</option>
        <option value="name,desc">Tên: Z → A</option>
      </select>
    </div>
  </div>

  <div class="product-list-layout">
    <aside class="sidebar">
      <h2 class="sidebar__title">Loại sản phẩm</h2>
      <ul class="category-list">
        <li>
          <button
            type="button"
            class="category-item"
            [class.category-item--active]="selectedCategoryId() === null"
            (click)="onCategoryClick(null)"
          >
            Tất cả
          </button>
        </li>
        @for (cat of categories(); track cat.id) {
          <li>
            <button
              type="button"
              class="category-item"
              [class.category-item--active]="selectedCategoryId() === cat.id"
              (click)="onCategoryClick(cat.id)"
            >
              {{ cat.name }}
            </button>
          </li>
        }
      </ul>
    </aside>

    <main class="product-content">
      @if (loading()) {
        <div class="product-grid">
          @for (i of [1,2,3,4,5,6]; track i) {
            <div class="product-card product-card--skeleton">
              <app-skeleton width="100%" height="200px" borderRadius="12px" />
              <div class="product-card__body">
                <app-skeleton width="80%" height="1.25rem" />
                <app-skeleton width="50%" height="1.5rem" />
              </div>
            </div>
          }
        </div>
      } @else if (error()) {
        <p class="error-message">{{ error() }}</p>
      } @else if (products().length === 0) {
        <p class="empty-message">Không tìm thấy sản phẩm nào.</p>
      } @else {
        <div class="product-grid">
          @for (product of products(); track product.id) {
            <a [routerLink]="['/products', product.id]" class="product-card">
              <div class="product-card__image-wrap">
                <img
                  [src]="product.thumbnail | imageUrl"
                  [alt]="product.name"
                  class="product-card__image"
                  loading="lazy"
                />
              </div>
              <div class="product-card__body">
                <h2 class="product-card__name">{{ product.name }}</h2>
                <p class="product-card__price">{{ formatPrice(product.price) }}</p>
                <span class="product-card__cta">Xem chi tiết</span>
              </div>
            </a>
          }
        </div>

        @if (pageInfo() && pageInfo()!.totalPages > 1) {
          <div class="pagination">
            <button
              type="button"
              class="pagination__btn"
              [disabled]="pageInfo()!.first"
              (click)="goToPage(pageInfo()!.page - 1)"
            >
              ← Trước
            </button>
            <div class="pagination__pages">
              @if (pageInfo()!.page > 2) {
                <button type="button" class="pagination__page" (click)="goToPage(0)">1</button>
                @if (pageInfo()!.page > 3) {
                  <span class="pagination__ellipsis">...</span>
                }
              }
              @for (p of getPageNumbers(); track p) {
                <button
                  type="button"
                  class="pagination__page"
                  [class.pagination__page--active]="p === pageInfo()!.page"
                  (click)="goToPage(p)"
                >
                  {{ p + 1 }}
                </button>
              }
              @if (pageInfo()!.page < pageInfo()!.totalPages - 3) {
                <span class="pagination__ellipsis">...</span>
                <button
                  type="button"
                  class="pagination__page"
                  (click)="goToPage(pageInfo()!.totalPages - 1)"
                >
                  {{ pageInfo()!.totalPages }}
                </button>
              }
            </div>
            <button
              type="button"
              class="pagination__btn"
              [disabled]="pageInfo()!.last"
              (click)="goToPage(pageInfo()!.page + 1)"
            >
              Sau →
            </button>
          </div>
          <div class="pagination-info">
            Trang {{ pageInfo()!.page + 1 }} / {{ pageInfo()!.totalPages }} 
            ({{ pageInfo()!.totalElements }} sản phẩm)
          </div>
        }
      }
    </main>
  </div>
</section>
